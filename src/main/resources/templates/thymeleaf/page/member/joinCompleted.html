<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="thymeleaf/layout/login_layout">
<th:block layout:fragment="css">
    <!--<link rel="stylesheet" th:href="@{/css/page/home.css}" >-->
</th:block>
<div layout:fragment="content" class="join-complete-area">
    <div>
        <p><a href="/user/home"><img src="/assets/image/common/logo_black.png" alt="" title="" /></a></p>
        <h2 style="font-size: 16px;">
            We have sent you an e-mail.<br/>
            Please check your e-mail and complete the verification.<br/>
            It cannot be used unless it is authenticated.<br/><br/>
            If you have not received the e-mail, please click the Resend button.
        </h2>
        <h2 style="font-size: 16px;">
            <ul>
                <li>
                    E-mail Code : <input type="text" name="emailCode" title="CODE" maxlength="35" class="id-icn" placeholder="Input email code." value=""/>
                </li>
            </ul>
        </h2>
        <h3><img src="/assets/image/content/member_pwsearch_complete.png" alt="" title="" /></h3>
        <div>
            <a href="javascript:fnConfirmEmail()">Confirm</a>
            <a href="javascript:fnResendEmail()">Resend</a>
        </div>
    </div>
    <input type="hidden" name="a4" id="a4" value="">
    <script>

        /*<![CDATA[*/
        const a4 = "[[${a4}]]";
        /*]]>*/
        $('#a4').val(a4);

        function fnConfirmEmail() {
            if($("input[name=emailCode]").val()==''){
                toastr.warning('Ipnut email code.');
                return;
            }


            $.ajax({
                url:"/user/join/confirmNew",
                type :  "POST",
                dataType : "json",
                data : {
                    "a7": $('#a4').val(),
                    emailCode: $("input[name=emailCode]").val()
                },
                success : function(response){
                    if(response.check){
                        toastr.success('Email verification is complete.');
                        setInterval(function(){
                            location.replace('/login');
                        },1500);
                    } else {
                        toastr.error(response.message);
                    }
                }
            });
        }

        function fnResendEmail() {
            if(a4==""){
                toastr.warning('No resend E-mail.');
                return;
            }
            $.ajax({
                url:"/user/join/resend",
                type :  "POST",
                dataType : "json",
                data : {"a4": $('#a4').val()},
                success : function(response){
                    if(response.check){
                        toastr.success('Email sending is complete.');
                        $('#a4').val(response.item.parameter);
                    } else {
                        toastr.error(response.message);
                    }
                }
            });

        }
    </script>
</div>
</html>