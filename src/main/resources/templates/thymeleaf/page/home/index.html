<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="thymeleaf/layout/main_layout">

<!-- index.html 고유 CSS 추가 -->
<th:block layout:fragment="css">
</th:block>

<!-- index.html 고유 스크립트 추가 -->
<th:block layout:fragment="script">

</th:block>
<th:block layout:fragment="content">
    <!-- 비주얼영역 -->
    <div class="main-vegas" >
        <div class="mv-btm"><img src="/assets/image/content/main_visual_scroll.svg" width="100" alt="" title="" /></div>
        <div class="mv-copy">
            <h2>COJAM</h2>
            <h3>Blockchain-based Online Social Prediction Platform</h3>
        </div>
    </div>
    <!-- 비주얼영역 끝 -->
    <!-- 퀘스트 -->
    <div class="main-notice" style="background: #F2F5FB;" th:disabled="${boardList} == null">
        <div>
            <h2>Popular Vote</h2>
            <h3>Convergence Platform of Knowledge based on Prediction</h3>
            <div class="quest-list-columns">
                <ul id="questMainList">
                    <th:block th:if="${questMainList}!=null">
                        <li th:each="item,i : ${questMainList}"
                            th:data-parameter1="${item.questKey}"
                            th:data-parameter2="${item.finished}"
                            th:onclick="'window.location.href = \'' + @{/user/quest/view(idx=${item.questKey})} + '\''"
                        >
                            <th:block th:if="${item.completed}">
                                <div>&nbsp;</div>
                            </th:block>
                            <h2>Total <span th:text="${#numbers.formatInteger(item.totalAmount,0,'COMMA')}"></span> CT</h2>
                            <p>
                                <span th:style="'background:url(/user/media/image?id='+${item.fileKey}+') center no-repeat; background-size:cover;'"></span>
                            </p>
                            <h3 th:id="'endDate_'+${i.index}"><span th:text="${item.dDay} < 0?'D'+${item.dDay}:'+'+${item.dDay}"></span>&nbsp;</h3>
                            <script>
                                /*<![CDATA[*/
                                questEndDateTimeId = "endDate_[[${i.index}]]";
                                questEndDateTime = "[[${item.endDateTime}]]";
                                $('#'+questEndDateTimeId).append(changeUtcToLocal(questEndDateTime,'YYYY-MM-DD HH:mm'))
                                /*]]>*/
                            </script>
                            <h4 th:text="${item.questTitle}"></h4>
                            <ul>
                                <li th:each=" subItem , i : ${#strings.arraySplit(item.answersStr,'^#')}"
                                    th:with="answer=${#strings.arraySplit(subItem,'!+')}"
                                >
                                    <div th:text="${answer[0]}"></div>
                                    <p th:id="'answer_'+${item.questKey}+'_'+${i.index}"></p>
                                    <h2 th:id="'answerPercent_'+${item.questKey}+'_'+${i.index}"></h2>
                                    <script>
                                        /*<![CDATA[*/
                                        currentAnswerTotal = "[[${answer[1]}]]";
                                        totalAmount = "[[${item.totalAmount}]]";
                                        otherTotalToken = totalAmount - currentAnswerTotal;
                                        answerId = "answer_[[${item.questKey}]]_[[${i.index}]]";
                                        answerPercentId = "answerPercent_[[${item.questKey}]]_[[${i.index}]]";
                                        /*]]>*/
                                        var x = currentAnswerTotal;
                                        var y = totalAmount;
                                        result = x / y * 100;

                                        percent = Number(result);

                                        rateString = isNaN(Number(result).toFixed(2)) ? '0%' : Number(result).toFixed(2)+'% ('+currentAnswerTotal+' CT)';

                                        $('#'+answerId).text(rateString);
                                        if(totalAmount!=0){
                                            $('#'+answerPercentId).html('<div style="width:'+percent+'%;"></div>')
                                        }
                                    </script>
                                </li>
                            </ul>
                        </li>
                    </th:block>
                </ul>
            </div>
            <div><a th:href="@{/user/quest}">More</a></div>
            <br/>
            <br/>
        </div>
    </div>
    <!-- 공지사항 끝 -->

    <!-- 공지사항 -->
    <div class="main-notice" th:disabled="${boardList} == null">
        <div>
            <h2>Notice & News</h2>
            <h3>Stay connected with COJAM!</h3>
            <ul id="noticeTop3">
                <li th:if="${boardList}!=null" th:class="'item sort0'+${i.count}" class="item sort01" th:each="item, i: ${boardList}"
                    th:onclick="'window.location.href = \'' + @{/user/notice/view(idx=${item.boardKey})} + '\''"
                >
                    <p>
                        <span th:style="'background:url(/user/media/image?id='+${item.boardFile}+') center no-repeat; background-size:cover;'"></span>
                    </p>
                    <div>
                        <dl>
                            <dt>
                                <i class="uil uil-calendar-alt"></i>&nbsp;
                                <!--<th:block th:text="${#dates.format(item.createDateTime,'yyyy.MM.dd HH.mm')}"></th:block>-->
                                <span th:id="'noticeCreateDateTimeId_'+${i.index}"></span>&nbsp;
                                <script>
                                    /*<![CDATA[*/
                                    noticeCreateDateTimeId = "noticeCreateDateTimeId_[[${i.index}]]";
                                    noticeCreateDateTime = "[[${item.createDateTime}]]";
                                    $('#'+noticeCreateDateTimeId).append(changeUtcToLocal(noticeCreateDateTime,'YYYY.MM.DD HH.mm'))
                                    /*]]>*/
                                </script>
                            </dt>
                            <dd>
                                <span th:if="${i.count%2==0}" th:text="${item.categoryName}"></span>
                            <dd th:if="${i.count%2!=0}"><em th:text="${item.categoryName}">News</em></dd>
                            </dd>
                        </dl>
                        <h2 th:text="${item.boardTitle}"></h2>
                    </div>
                </li>
            </ul>
            <div><a th:href="@{/user/notice}">More</a></div>
        </div>
    </div>
    <!-- 공지사항 끝 -->
    <br/><br/>
    <!-- 서비스 -->
    <div class="main-service">
        <div>
            <h2>Cojam Service</h2>
            <h3>Operate the Service Through Advanced Technology</h3>
            <dl>
                <dt>&nbsp;</dt>
                <dd>
                    <div>
                        <p>
                            <span><img src="/assets/image/content/main_service_icon01.svg" alt="" title="" /></span>
                        </p>
                        <h2>Google Cloud Platform</h2>
                        <h3>Our Service based on Google Cloud Platformfor Security and Stability.</h3>
                    </div>
                    <div>
                        <p>
                            <span><img src="/assets/image/content/main_service_icon02.svg" alt="" title="" /></span>
                        </p>
                        <h2>Blockchain</h2>
                        <h3>It ensures transparency and stability and can participate in predictive platforms.</h3>
                    </div>
                    <div>
                        <p>
                            <span><img src="/assets/image/content/main_service_icon03.svg" alt="" title="" /></span>
                        </p>
                        <h2>HTML5 Web Standard</h2>
                        <h3>Developed by HTML5 Web Standard to support a variety of browsers.</h3>
                    </div>
                    <div>
                        <p>
                            <span><img src="/assets/image/content/main_service_icon04.svg" alt="" title="" /></span>
                        </p>
                        <h2>Mobile Web</h2>
                        <h3>Any Where! Any Time! You can enjoy with Mobile.</h3>
                    </div>
                    <div>
                        <p>
                            <span><img src="/assets/image/content/main_service_icon05.svg" alt="" title="" /></span>
                        </p>
                        <h2>Responsible Web</h2>
                        <h3>It is possible to participate in services from browsers on various devices through Responsible Web.</h3>
                    </div>
                    <div>
                        <p>
                            <span><img src="/assets/image/content/main_service_icon06.svg" alt="" title="" /></span>
                        </p>
                        <h2>Realtime Service</h2>
                        <h3>All our prediction contents are fully run by Smart Contracts.</h3>
                    </div>
                </dd>
            </dl>
        </div>
    </div>
    <!-- 서비스 끝 -->

    <th:block  th:replace="thymeleaf/fragment/popup :: homePopup(${mainPopupList})"></th:block>
    <!-- 질문답변 끝 -->
    <script th:inline="javascript">
        $(document).ready(function (){
            fnGetQuestList();
            fnGetNoticeList();
        });


        function fnGetNoticeList(){
            ajaxView("/user/home/notice","POST",null,"noticeTop3");

        }

        function fnGetQuestList(){
            ajaxView("/user/home/questInfo","POST",null,"questMainList");
        }


        $(document).on({
            mouseenter: function () {
                $(this).find('p span').stop().animate({ width : '105%', margin : '0 0 0 -2.5%', opacity: '0.5' }, 300, 'easeOutQuad');
            },

            mouseleave: function () {
                $(this).find('p span').stop().animate({ width : '100%', margin : '0', opacity: '1.0' }, 300, 'easeOutQuad');
            }

        }, '.main-notice > div > ul > li');
    </script>
</th:block>
</html>