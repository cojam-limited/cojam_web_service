<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="thymeleaf/layout/default_layout">

<th:block layout:fragment="css">
</th:block>


<div layout:fragment="content">
    <!-- 타이틀영역 -->
    <div class="title-area">
        MYPAGE
    </div>
    <!-- 타이틀영역 끝 -->
    <th:block  th:replace="thymeleaf/fragment/popup :: modalSendCt"></th:block>

    <th:block  th:replace="thymeleaf/fragment/popup :: modalVotingDetail"></th:block>

    <th:block  th:replace="thymeleaf/fragment/popup :: modalGroundDetail"></th:block>

    <th:block  th:replace="thymeleaf/fragment/popup :: modalTransferDetail"></th:block>

    <th:block  th:replace="thymeleaf/fragment/popup :: modalRecommend"></th:block>

    <th:block  th:replace="thymeleaf/fragment/popup :: modalReward"></th:block>

    <th:block  th:replace="thymeleaf/fragment/popup :: modalNoReward"></th:block>

    <th:block  th:replace="thymeleaf/fragment/popup :: modalCtNotice"></th:block>

    <!-- 마이페이지 - 기본정보 -->
    <div class="mypage-info">
        <dt>
            <div><i class="uil uil-envelope-check"></i> Email : <span th:text="${member.memberEmail}"></span></div>
            <div><i class="uil uil-wallet"></i> Wallet address : <span id="myWalletAddress" th:text="${wallet.walletAddress}"></span><i class="uil uil-copy" onclick="clipBoard('myWalletAddress')"></i></div>
            <div><i class="uil uil-history"></i> Wallet status :
                <span id="myWalletStatus"></span>
            </div>
            <div><i class="uil uil-coins"></i> Wallet balance :
                <span id="myWalletBalance"></span>
                <span id="myWalletBalanceToKrw" class="myWalletBalance" style="cursor: pointer"></span>
                <span id="myWalletBalanceToUsd" class="myWalletBalance" style="display: none;cursor: pointer"></span>
                <a data-izimodal-open="#modalCtNotice" data-izimodal-transitionin="comingIn"><i class="uil uil-question-circle"></i></a>
            </div>
        </dt>
        <dd>
            <th:block th:if="${loginRewardInfo} > 0">
                <a id="loginRewardBtn" href="javascript:toastr.error('You got your reward today.')" class="btn-grey">Login Reward</a>
            </th:block>
            <th:block th:unless="${loginRewardInfo} > 0">
                <a id="loginRewardBtn" href="javascript:fnLoginReward()" class="btn-red">Login Reward</a>
            </th:block>

            <th:block th:if="${!member.walletLock}">
                <a href="#" class="btn-purple" data-izimodal-open="#modalSendCT" data-izimodal-transitionin="comingIn">CT Send</a>
            </th:block>
            <th:block th:if="${member.walletLock}">
                <a href="javascript:alert('Your wallet is lock.');" class="btn-grey" >CT Send</a>
            </th:block>
            <a href="javascript:fnRecommendOpen();" class="btn-blue">Recommend User</a>
        </dd>
    </div>
    <!-- 마이페이지 - 기본정보 끝 -->


    <!-- 마이페이지 - 탭버튼 -->
    <ul class="mypage-tab">
        <li class="mt-tab01 active" id="tab_voting"><i class="uil uil-chart-line"></i> <span>Votings</span></li>
        <li class="mt-tab02" id="tab_ground"><i class="uil uil-files-landscapes-alt"></i> <span>Grounds</span></li>
        <li class="mt-tab03" id="tab_transfer"><i class="uil uil-file-info-alt"></i> <span>CT Transfer</span></li>
    </ul>
    <!-- 마이페이지 - 탭버튼 끝 -->


    <!-- 마이페이지 - 내용 -->
    <div class="mypage-content">
        <div class="mc-votings">
            <h2><span>Votings</span></h2>
            <div id="myVotingList">
                <ul>
                    <li><strong>Reward</strong></li>
                    <li><strong>Title</strong></li>
                    <li><strong>Status Flow</strong></li>
                    <li style="text-align:center;"><strong>My Answer</strong></li>
                    <li style="text-align:center;"><strong>Multiply</strong></li>
                    <li style="text-align:center;"><strong>Prediction Fee</strong></li>
                </ul>
                <th:block th:if="${myVotingList}!=null">
                    <ul th:each="item : ${myVotingList}" >
                        <li>
                            <span>Reward : </span>
                            <th:block th:if="${item.answerSelected}">
                                <span
                                        th:data-detailBettingtKey="${item.bettingKey}"
                                        th:onclick="fnReward('S',this.getAttribute('data-detailBettingtKey'))"
                                      style="vertical-align: middle;cursor:pointer;display: inline-block; width: 20px; height: 20px; border-radius: 50%; background: #ef168f;"
                                >
                                </span>
                            </th:block>
                            <th:block th:unless="${item.answerSelected}">
                                <th:block th:if="${item.questStatus == 'SUCCESS' || item.questStatus == 'ADJOURN'}">
                                    <th:block th:if="${item.questStatus == 'SUCCESS'}">
                                        <span th:data-detailBettingtKey="${item.bettingKey}"
                                              th:onclick="fnNoReward('A',this.getAttribute('data-detailBettingtKey'))"
                                              style="vertical-align: middle;cursor:pointer;display: inline-block; width: 20px; height: 20px; border-radius: 50%; background: #999999;"
                                        ></span>
                                    </th:block>
                                    <th:block th:unless="${item.questStatus == 'SUCCESS'}">
                                        <span th:data-detailBettingtKey="${item.bettingKey}"
                                              th:onclick="fnReward('A',this.getAttribute('data-detailBettingtKey'))"
                                              style="vertical-align: middle;cursor:pointer;display: inline-block; width: 20px; height: 20px; border-radius: 50%; background: #08298A;"
                                        ></span>
                                    </th:block>

                                </th:block>
                                <th:block th:unless="${item.questStatus == 'SUCCESS' || item.questStatus == 'ADJOURN'}">
                                    <span style="vertical-align: middle;cursor:pointer;display: inline-block; width: 20px; height: 20px; border-radius: 50%;border:1px solid;"></span>
                                </th:block>
                            </th:block>
                        </li>
                        <li th:data-detailQuestKey="${item.questKey}"
                            th:onclick="fnSetGroundDetail(this.getAttribute('data-detailQuestKey'))">
                            <span>Title : </span><th:block th:text="${item.questTitle}"></th:block>
                        </li>
                        <th:block th:switch="${item.questStatus}">
                            <th:block th:case="ONGOING">
                                <li>
                                    <th:block th:if="${item.pending}">
                                        <p>Pending</p>
                                    </th:block>
                                    <span>Status Flow : </span>
                                    <ol>
                                        <li th:class="complete">
                                            <h2>Ongoing</h2>
                                        </li>
                                        <li>
                                            <h2>Invaild</h2>
                                        </li>
                                        <li>
                                            <h2>Approve</h2>
                                        </li>
                                        <li>
                                            <h2>Adjourn</h2>
                                        </li>
                                        <li>
                                            <h2>Success</h2>
                                        </li>
                                    </ol>
                                </li>
                            </th:block>
                            <th:block th:case="INVALID">
                                <li>
                                    <p>Invalid</p>
                                    <span>Status Flow : </span>
                                    <ol>
                                        <li class="complete">
                                            <h2>Ongoing</h2>
                                        </li>
                                        <li class="complete">
                                            <h2>Invaild</h2>
                                        </li>
                                        <li>
                                            <h2>Approve</h2>
                                        </li>
                                        <li>
                                            <h2>Finish</h2>
                                        </li>
                                        <li>
                                            <h2>Success</h2>
                                        </li>
                                    </ol>
                                </li>
                            </th:block>
                            <th:block th:case="APPROVE">

                                <li th:if="${item.completed}">
                                    <th:block th:if="${item.pending}">
                                        <p>Pending</p>
                                    </th:block>
                                    <span>Status Flow : </span>
                                    <ol class="fourstep">
                                        <li class="complete">
                                            <h2>Ongoing</h2>
                                        </li>
                                        <li class="complete">
                                            <h2>Approve</h2>
                                        </li>
                                        <li class="complete">
                                            <h2>Finish</h2>
                                        </li>
                                        <li>
                                            <span></span>
                                            <h2>Success</h2>
                                        </li>
                                    </ol>
                                </li>
                                <li th:unless="${item.completed}">
                                    <th:block th:if="${item.pending}">
                                        <p>Pending</p>
                                    </th:block>
                                    <span>Status Flow : </span>
                                    <ol class="fourstep">
                                        <li class="complete">
                                            <h2>Ongoing</h2>
                                        </li>
                                        <li class="complete">
                                            <h2>Approve</h2>
                                        </li>
                                        <li>
                                            <h2>Finish</h2>
                                        </li>
                                        <li>
                                            <span></span>
                                            <h2>Success</h2>
                                        </li>
                                    </ol>
                                </li>
                            </th:block>
                            <th:block th:case="ADJOURN">
                                <li>
                                    <th:block th:if="${item.pending}">
                                        <p>Pending</p>
                                    </th:block>
                                    <span>Status Flow : </span>
                                    <ol class="fourstep">
                                        <li class="complete">
                                            <h2>Ongoing</h2>
                                        </li>
                                        <li class="complete">
                                            <h2>Approve</h2>
                                        </li>
                                        <li class="complete">
                                            <h2>Finish</h2>
                                        </li>
                                        <li class="complete"
                                            style="background: #08298A;"
                                            >
                                            <h2>Adjourn</h2>
                                        </li>
                                    </ol>
                                </li>
                            </th:block>
                            <th:block th:case="SUCCESS">
                                <li>
                                    <th:block th:if="${item.pending}">
                                        <p>Pending</p>
                                    </th:block>
                                    <span>Status Flow : </span>
                                    <ol class="fourstep">
                                        <li class="complete">
                                            <h2>Ongoing</h2>
                                        </li>
                                        <li class="complete">
                                            <h2>Approve</h2>
                                        </li>

                                        <li class="complete">
                                            <h2>Finish</h2>
                                        </li>
                                        <th:block th:if="${item.answerSelected}">
                                            <li class="complete"
                                                style="background: #ef168f;"
                                                >
                                                <span></span>
                                                <h2>Success</h2>
                                            </li>
                                        </th:block>
                                        <th:block th:unless="${item.answerSelected}">
                                            <li class="complete"
                                                style="background: #ef168f;"
                                                >
                                                <span></span>
                                                <h2>Success</h2>
                                            </li>
                                        </th:block>

                                    </ol>
                                </li>
                            </th:block>
                        </th:block>
                        <li><span>My Answer : </span><th:block th:text="${item.answerTitle}"></th:block> (<th:block th:text="${#numbers.formatInteger(item.bettingCoin,0,'COMMA')}"></th:block> CT)</li>
                        <li>
                            <span>Multiply : </span><th:block th:text="${item.magnification}"></th:block>
                        </li>
                        <li><span>Prediction Fee : </span><th:block th:text="${item.magnificationCoin} % 1 == 0?${#numbers.formatInteger(item.magnificationCoin,0,'COMMA')}:${#numbers.formatDecimal(item.magnificationCoin, 0, 'COMMA', 2, 'POINT')}"></th:block> CT</li>
                    </ul>
                </th:block>
                <th:block th:if="${pagination} != null" th:replace="thymeleaf/fragment/page :: paging-list(${pagination})"></th:block>
            </div>
        </div>
        <div class="mc-grounds">
            <h2><span>Grounds</span></h2>
            <div id="groundList">
                <ul>
                    <li><strong>Category</strong></li>
                    <li><strong>Title</strong></li>
                    <li><strong>Status Flow</strong></li>
                    <li style="text-align:center;"><strong>Total</strong></li>
                    <li style="text-align:center;"><strong>Total Creator Fee</strong></li>
                    <li style="text-align:center;"><strong>Donation Fee</strong></li>
                </ul>
                <th:block th:if="${myQuestList} != null">
                    <ul th:each="item : ${myQuestList}"
                        th:data-detailQuestKey="${item.questKey}"
                        onclick="fnSetGroundDetail(this.getAttribute('data-detailQuestKey'))"
                    >
                        <li>
                            <span>Category : </span>
                            <th:block th:text="${item.categoryName}"></th:block>
                        </li>
                        <li>
                            <span>Title : </span>
                            <th:block th:text="${item.questTitle}"></th:block>
                        </li>
                        <li>
                            <span>Status Flow : </span>
                            <th:block th:if="${item.pending}">
                                <p>Pending</p>
                            </th:block>
                            <th:block th:if="${item.questStatus}=='INVALID'">
                                <p>Invalid</p>
                            </th:block>
                            <th:block th:if="${item.questStatus}=='ADJOURN'">
                                <p>Adjourn</p>
                            </th:block>

                                <th:block th:switch="${item.questStatus}">
                                    <th:block th:case="ONGOING">
                                        <ol>
                                            <li class="complete">
                                                <span></span>
                                                <h2>Ongoing</h2>
                                            </li>
                                            <li>
                                                <span></span>
                                                <h2>Invaild</h2>
                                            </li>
                                            <li>
                                                <span></span>
                                                <h2>Approve</h2>
                                            </li>
                                            <li>
                                                <span></span>
                                                <h2>Finish</h2>
                                            </li>
                                            <li>
                                                <span></span>
                                                <h2>Success</h2>
                                            </li>
                                        </ol>
                                    </th:block>
                                    <th:block th:case="INVALID">
                                        <ol>
                                            <li class="complete">
                                                <span></span>
                                                <h2>Ongoing</h2>
                                            </li>
                                            <li class="complete">
                                                <span></span>
                                                <h2>Invaild</h2>
                                            </li>
                                            <li>
                                                <span></span>
                                                <h2>Approve</h2>
                                            </li>
                                            <li>
                                                <span></span>
                                                <h2>Finish</h2>
                                            </li>
                                            <li>
                                                <span></span>
                                                <h2>Success</h2>
                                            </li>
                                        </ol>
                                    </th:block>
                                    <th:block th:case="APPROVE">
                                        <ol class="fourstep">
                                            <li class="complete">
                                                <span></span>
                                                <h2>Ongoing</h2>
                                            </li>
                                            <li class="complete">
                                                <span></span>
                                                <h2>Approve</h2>
                                            </li>
                                            <li>
                                                <span></span>
                                                <h2>Finish</h2>
                                            </li>
                                            <li>
                                                <span></span>
                                                <h2>Success</h2>
                                            </li>
                                        </ol>
                                    </th:block>
                                    <th:block th:case="ADJOURN">
                                        <ol class="fourstep">
                                            <li class="complete">
                                                <span></span>
                                                <h2>Ongoing</h2>
                                            </li>
                                            <li class="complete">
                                                <span></span>
                                                <h2>Approve</h2>
                                            </li>
                                            <li class="complete">
                                                <span></span>
                                                <h2>Finish</h2>
                                            </li>
                                            <li class="complete" style="background: #ef168f;">
                                                <span></span>
                                                <h2>Adjourn</h2>
                                            </li>
                                        </ol>
                                    </th:block>
                                    <th:block th:case="SUCCESS">
                                        <ol class="fourstep">
                                            <li class="complete">
                                                <span></span>
                                                <h2>Ongoing</h2>
                                            </li>

                                            <li class="complete">
                                                <span></span>
                                                <h2>Approve</h2>
                                            </li>
                                            <li class="complete">
                                                <span></span>
                                                <h2>Finish</h2>
                                            </li>
                                            <li class="complete" style="background: #ef168f;">
                                                <span></span>
                                                <h2>Success</h2>
                                            </li>
                                        </ol>
                                    </th:block>
                                </th:block>
                        </li>
                        <li><span>Total  : </span><th:block th:text="${#numbers.formatInteger(item.totalAmount,0,'COMMA')}"></th:block> CT</li>
                        <li><span>Total Creator Fee : </span><th:block th:text="${item.totalCreatorFee} % 1 == 0? ${#numbers.formatInteger(item.totalCreatorFee,0,'COMMA')} :${#numbers.formatDecimal(item.totalCreatorFee, 0, 'COMMA', 2, 'POINT')}"></th:block> CT (<th:block th:text="${item.creatorFee}"></th:block>%)</li>
                        <li><span>Donation Fee : </span><th:block th:text="${item.totalCharityFee} % 1 == 0? ${#numbers.formatInteger(item.totalCharityFee,0,'COMMA')} :${#numbers.formatDecimal(item.totalCharityFee, 0, 'COMMA', 2, 'POINT')}"></th:block> CT (<th:block th:text="${item.charityFee}"></th:block>%)</li>
                        <th:block th:if="${item.pending}">
                            <li class="pending">Pending</li>
                        </th:block>
                        <th:block th:if="${item.questStatus}=='INVALID'">
                            <li class="pending">Invalid</li>
                        </th:block>
                        <th:block th:if="${item.questStatus}=='ADJOURN'">
                            <li class="pending">Adjourn</li>
                        </th:block>

                    </ul>
                </th:block>
                <th:block th:if="${pagination} != null" th:replace="thymeleaf/fragment/page :: paging-list(${pagination})"></th:block>
            </div>
        </div>
        <div class="mc-transfer">
            <h2><span>CT Transfer</span></h2>
            <div id="transactionList">
                <ul>
                    <li><strong>Spender Address</strong></li>
                    <li><strong>Recipient Address</strong></li>
                    <li style="text-align:center;"><strong>CT Amount</strong></li>
                    <li><strong>Created DTTM</strong></li>
                </ul>
                <th:block th:if="${transactionList} !=null">
                    <ul th:each="item,i : ${transactionList}"
                        th:data-transactionKey="${item.transactionKey}"
                        onclick="fnSetTransactionKey(this.getAttribute('data-transactionKey'))"
                         >
                        <li th:id="'spenderAddress'+${item.transactionKey}">
                            <span>Spender Address : </span>
                            <th:block th:if="${item.walletName}!=''" th:text="${item.walletName}">
                            </th:block>
                            <th:block th:unless="${item.walletName}!=''">
                                <th:block th:text="${item.spenderAddress}"></th:block>
                                <th:block th:if="${item.spenderAddress == wallet.walletAddress}">
                                    (<th:block th:text="${member.memberId}"></th:block>)
                                </th:block>
                                <th:block th:unless="${item.spenderAddress == wallet.walletAddress}">
                                    <th:block th:if="${item.memberId}!=null" th:text="'('+${item.memberId}+')'"></th:block>
                                </th:block>
                            </th:block>

                        </li>
                        <li th:id="'recipientAddress'+${item.transactionKey}"><span>Recipient Address : </span><th:block th:text="${item.recipientAddress}"></th:block><th:block th:if="${item.recipientAddress == wallet.walletAddress}">(<th:block th:text="${member.memberId}"></th:block>)</th:block><th:block th:unless="${item.recipientAddress == wallet.walletAddress}"><th:block th:if="${item.memberId}!=null" th:text="'('+${item.memberId}+')'"></th:block></th:block></li>
                        <li th:id="'amount'+${item.transactionKey}"><span>CT Amount : </span><th:block th:if="${item.spenderAddress==wallet.walletAddress}">-</th:block><th:block th:text="${#numbers.formatDecimal(item.amount,0,'COMMA',2,'POINT')}"></th:block> CT</li>
                        <li th:id="'createDateTimeStr'+${item.transactionKey}">
                            <span>Created DTTM : </span>
                            <h2 th:id="'sendCtDateTimeId_'+${i.index}"></h2>
                            <script>
                                /*<![CDATA[*/
                                sendCtDateTimeId = "sendCtDateTimeId_[[${i.index}]]";
                                sendCtDateTime = "[[${item.createdDateTime}]]";
                                $('#'+sendCtDateTimeId).append(changeUtcToLocal(sendCtDateTime,'YYYY.MM.DD (HH:mm)'));
                                /*]]>*/
                            </script>
                        </li>
                        <input type="hidden" th:id="'transactionId'+${item.transactionKey}" th:value="${item.transactionId}"/>
                    </ul>
                </th:block>
                <th:block th:if="${pagination} != null" th:replace="thymeleaf/fragment/page :: paging-list(${pagination})"></th:block>
            </div>
            <form name="listFrm">
                <input type="hidden" name="page" id="listPage"/>
                <input type="hidden" name="walletAddress" th:value="${wallet.walletAddress}"/>
                <input type="hidden" name="memberId" th:value="${member.memberId}"/>
            </form>
            <input type="hidden" id="copy_text" value=""/>
        </div>
    </div>
    <!-- 마이페이지 - 내용 끝 -->
    <script>
        $("body").addClass("bg-mypage");
        $(document).ready(function (e){
            fnGetMyVotingList();
            fnGetWalletStatus();
        });

        function fnSetTransactionKey(key){
            transactionKey = key;
            spenderAddress = $('#spenderAddress'+key).text().replace('Spender Address : ','');
            recipientAddress = $('#recipientAddress'+key).text().replace('Recipient Address : ','');
            transactionId = $('#transactionId'+key).val();
            ctAmount = $('#amount'+key).text().replace('CT Amount : ','');
            createDateTimeStr = $('#createDateTimeStr'+key).find("h2").text().replace('Created DTTM : ','');
            $("#modalMypageTransfer").iziModal('open');
        }

        function fnSetGroundDetail(key){
            detailQuestKey = key;
            $("#modalGroundDetail").iziModal('open');
        }
        let selectTabId='tab_voting';
        $(document).on('click','.mypage-tab > li',function(e){
            const id = $(this).attr('id');
            $("#listPage").val(1);
            if(id == 'tab_voting'){
                selectTabId='tab_voting';
            }else if(id == 'tab_ground'){
                selectTabId='tab_ground';
                fnGetGroundList();
            }else if(id == 'tab_transfer'){
                selectTabId='tab_transfer';
                fnGetTransactionList();
            }
        });

        function fnMovePage(page){
            $("#listPage").val(page);
            if(selectTabId == 'tab_voting'){
                fnGetMyVotingList()
            }else if(selectTabId == 'tab_ground'){
                fnGetGroundList();
            }else if(selectTabId == 'tab_transfer'){
                fnGetTransactionList();
            }
        }

        function fnGetTransactionList(){
            ajaxView("/user/mypage/transaction","POST",$("form[name=listFrm]").serialize(),"transactionList");
        }

        function fnGetMyVotingList(){
            ajaxView("/user/mypage/voting","POST",$("form[name=listFrm]").serialize(),"myVotingList");
        }

        function fnGetGroundList(){
            ajaxView("/user/mypage/ground","POST",$("form[name=listFrm]").serialize(),"groundList");
        }



        function fnSetSuccessBetting(key){
            if(confirm('Would you like to receive compensation now?')){
                $.ajax({
                    url: "/user/quest/successBetting",
                    type: "POST",
                    data : {
                        "bettingKey" : key
                    },
                    success : function(response){
                        if(response.check){
                            toastr.success('success');
                            fnMovePage(1);
                        } else {
                            toastr.error(response.message);
                        }
                    }
                });
            }

        }

        function fnRecommendOpen(){
            $("#modalRecommend").iziModal('open');
        }

        function clipBoard(elementId) {
            var aux = document.createElement("input");
            aux.setAttribute("value", document.getElementById(elementId).innerHTML);
            document.body.appendChild(aux);
            aux.select();
            document.execCommand("copy");
            document.body.removeChild(aux);
            toastr.success("Copied wallet address.");
        }

        function fnReward(type,key){

            betKey = key;
            rewardType = type;
            $("#modalReward").iziModal('open');
        }

        function fnNoReward(type,key){
            betKeyNo = key;
            $("#modalNoReward").iziModal('open');
        }

        function fnGetCoingeckoPrice(type,amount){

            $.ajax({
                url: "https://api.coingecko.com/api/v3/simple/price",
                type: "GET",
                data : {
                    "ids" : "communitytoken",
                    "vs_currencies" : type
                },
                beforeSend : function(xhr)
                {

                },
                success : function(response){
                    if(type=='krw'){
                        let coinAmount = 0.0;
                        if(response.communitytoken.krw){
                            coinAmount=response.communitytoken.krw;
                        }
                        coinAmount = parseFloat(coinAmount);
                        amount = parseFloat(amount);
                        const totalAmount = (coinAmount * amount).toFixed(2);
                        $('#myWalletBalanceToKrw').html('('+'≒'+totalAmount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")+' KRW'+')');

                    }else if(type=='usd'){
                        let coinAmount = 0.0;
                        if(response.communitytoken.usd){
                            coinAmount=response.communitytoken.usd;
                        }

                        coinAmount = parseFloat(coinAmount);
                        amount = parseFloat(amount);
                        const totalAmount = (coinAmount * amount).toFixed(2);
                        $('#myWalletBalanceToUsd').html('('+'≒'+totalAmount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")+' USD'+')');
                    }
                },complete: function () {

                },
                error : function(error){

                }
            });
        }


        $(document).on('click','.myWalletBalance',function (e){
            if($(this).attr('id')=='myWalletBalanceToKrw'){
                $("#myWalletBalanceToKrw").hide();
                $('#myWalletBalanceToUsd').show();
            }else if($(this).attr('id')=='myWalletBalanceToUsd'){
                $('#myWalletBalanceToUsd').hide();
                $("#myWalletBalanceToKrw").show();
            }

        });


        function fnLoginReward(){
                $.ajax({
                    url: "/user/mypage/loginReward",
                    type: "POST",
                    success : function(response){
                        if(response.check){
                            toastr.success('Compensation has been paid.');
                            $('#loginRewardBtn').addClass("btn-grey");
                            $('#loginRewardBtn').removeClass("btn-red");
                            $('#loginRewardBtn').attr('href','javascript:toastr.error(\'You got your reward today.\');');
                        } else {
                            toastr.error(response.message);
                        }
                    }
                });
        }


        function fnGetWalletStatus(){
            $.ajax({
                url:"/user/mypage/walletInfo",
                type :  "POST",
                contentType : false,
                processData : false,
                beforeSend : function(xhr)
                {
                    xhr.setRequestHeader($("meta[name='_csrf_header']").attr("content"),$("meta[name='_csrf']").attr("content"));
                },
                complete: function () {
                },
                success : function(response){
                    if(response.check){
                        const item = response.item;
                        $('#myWalletStatus').html(item.walletStatus);
                    }
                },error : function (e){

                }
            });
        }
    </script>
    <th:block layout:fragment="script">
    </th:block>
</div>

</html>