<html lagn="ko"
      xmlns:th="http://www.thymeleaf.org">
<!-- 모달 - 퀘스트 등록 -->
<th:block  th:fragment="modalQuestAdd(${seasonCategoryList})">
    <div th:class="modal-quest-add" th:id="modalQuestAdd" style="display: none;">
        <form name="questForm" id="questForm" method="post" action="">
            <fieldset>
                <legend>등록</legend>
                <div class="mqa-area">
                    <dl class="mqa-header">
                        <dt>Create New Prediction</dt>
                        <dd><i id="questModalClose" class="uil uil-times modal-close" data-izimodal-close=""></i></dd>
                    </dl>
                    <ul class="mqa-content2">
                        <li><input name="questTitle" id="questTitle" type="text" class="w100p" placeholder="Please enter a title" /></li>
                        <li>
                            <select name="seasonCategoryKey" title="" class="w100p">
                                <option value="" selected="selected">Please select a category</option>
                                <option th:if="${seasonCategoryList} != null"
                                        th:each="item : ${seasonCategoryList}"
                                        th:value="${item.categoryKey}" th:text="${item.categoryName}"></option>
                            </select>
                        </li>
                        <li><input name="endDateTime" type="text" id="endDateTime" class="w100p" placeholder="Please enter a date" /></li>
                        <li>
                            <div class="input-file">
                                <label>
                                    File Attach
                                    <input type="file" name="file" onchange="javascript:document.getElementById('fileRoute').value=this.value">
                                </label>
                                <input type="text" readonly="readonly" title="File Route" id="fileRoute" placeholder="Attach an image">
                            </div>
                        </li>
                        <li><input name="snsUrl" type="text" class="w100p" placeholder="Enter the sns url" /></li>
                    </ul>
                    <ol class="mqa-content1">
                        <li>Select a Type</li>
                        <li>
                            <a><i class="uil uil-plus-circle"></i></a>
                            <a><i class="uil uil-minus-circle"></i></a>
                        </li>
                    </ol>
                    <ul class="mqa-content2" id="answerList">
                        <li><input name="answers" type="text" class="w100p" placeholder="" value="Yes" /></li>
                        <li><input name="answers" type="text" class="w100p" placeholder="" value="No" /></li>
                    </ul>
                    <p class="mqa-btn">
                        <a href="javascript:fnSaveQuest()">Complete</a>
                    </p>
                </div>
            </fieldset>
        </form>
    </div>
    <script>
        $(document).ready(function(){

            $('#modalQuestAdd').iziModal({width : '500px'});
            // 날짜 - 퀘스트 등록 //
            $("#endDateTime").datetimepicker({
                dateFormat:'yy-mm-dd',
                // timepicker 설정
                timeFormat:'hh:mm:ss',
                //controlType:'select',
                //oneLine:true,
            });
            $('#endDateTime').val($.datepicker.formatDate('yy-mm-dd', new Date()));
        });

        $(document).on('click','.mqa-content1 > li > a',function (e){

            if($(this).find('.uil-plus-circle').length > 0){
                const liChild = document.createElement('li');
                const inputChild = document.createElement('input');

                inputChild.setAttribute("type", "text");
                inputChild.setAttribute("name", "answers");
                inputChild.setAttribute("value", "Yes");
                inputChild.setAttribute("class", "w100p");
                inputChild.setAttribute("placeholder", "");
                liChild.appendChild(inputChild);

                $('#answerList').append(liChild);
            }else{
                $('#answerList > li').last().remove();
            }
        });
        function fnSaveQuest(){
            if(confirm("Would you like to register?")){
                const form = $('#questForm')[0];
                const data = new FormData(form);
                $.ajax({
                    url:"/user/quest/register",
                    type :  "POST",
                    enctype: 'multipart/form-data',
                    data : data,
                    contentType : false,
                    processData : false,
                    success : function(response){
                        if(response.check){
                            toastr.success('Complete! Please wait manager confirm.');
                            $('#questModalClose').click();
                            //location.href = '/cms/popup/view?idx='+response.item;
                        } else {
                            toastr.error(response.message);
                        }
                    }
                });
            }
        }
    </script>
    <th:block layout:fragment="script">
    </th:block>
</th:block>
<th:block  th:fragment="modalCategoryAdd(${categoryList})">
    <!-- 모달 - 카테고리 등록 -->
    <div class="modal-category-add" id="modalCategoryAdd" style="display: none;">
        <form name="addForm" method="post" action="">
            <fieldset>
                <div class="mca-area">
                    <h2>Add New Category</h2>
                    <div>
                        <input type="text" placeholder="카테고리명을 입력하세요.">
                        <a href="#" class="mca-add-btn"><i class="uil uil-plus-circle"></i></a>
                    </div>
                    <h2>Delete Category</h2>
                    <p class="close-btn"><i class="uil uil-times modal-close" data-izimodal-close=""></i></p>
                    <ul>
                        <li th:each="item : ${categoryList}">
                            <div th:text="${item.categoryName}"></div>
                            <a href="#"class=mca-delete-btn>
                                <i class="uil uil-minus-circle"></i>
                            </a>
                            <input th:type="hidden" th:name="categoryList" th:value="${item.boardCategoryKey}+'|'+${item.categoryName}">
                        </li>
                    </ul>
                    <p class="mca-btn">
                        <a href="#">Complete</a>
                    </p>
                </div>
            </fieldset>
        </form>
    </div>
    <!-- 모달 - 카테고리 등록 끝 -->
    <th:block layout:fragment="script">
        <script>
            $(document).ready(function(){
                $('#modalCategoryAdd').iziModal({width : '500px'})
            });
        </script>
    </th:block>
</th:block>
<th:block th:fragment="homePopup(${mainPopupList})">
    <script th:src="@{/assets/js/jquery.cookie.js}"></script>
    <th:block
        th:if="${mainPopupList} != null"
        th:each="popup : ${mainPopupList}"
    >
        <!-- 레이어팝업 -->
        <div th:id="'mainPop'+${popup.popupKey}" class="main-popup" th:style="'top:'+${popup.positionX}+'px; left:'+${popup.positionY}+'px;display:none;'" >
            <div>
                <a href="#">
                    <img th:src="@{/user/media/image(id=${popup.popupFileKey})}" alt="" title="" />
                </a>
            </div>
            <dl>
                <dt class="mainPopDayClose">Don't open any more today</dt>
                <dd class="mainPopupClose">Close</dd>
            </dl>
        </div>
        <!-- 레이어팝업 끝 -->
        <script>
            $(document).ready(function(){

            });


            $('.main-popup').each(function (){
               const popId = $(this).attr('id');
               if($.cookie(popId)!='Y'){
                   $(this).fadeIn();
               }
            });

            $(document).on('click','.mainPopupClose',function (e){
               const popIndex = $('.mainPopupClose').index(this);
               $('.main-popup').eq(popIndex).fadeOut('fast');

            });

            $(document).on('click','.mainPopDayClose',function (e){
                const popIndex = $('.mainPopDayClose').index(this);
                $.cookie($('.main-popup').eq(popIndex).attr('id'), 'Y', {expires : 1});
                $('.main-popup').eq(popIndex).fadeOut('fast');
            });
        </script>
    </th:block>
</th:block>

<th:block  th:fragment="modalQuestSeason">
    <!-- 모달 - 퀘스트 시즌 -->
    <div class="modal-quest-season" id="modalQuestSeason" style="display:none;">
        <div class="mqs-area">
            <dl class="mqs-header">
                <dt>Create Season of COJAM Service!</dt>
                <dd><i class="uil uil-times modal-close" data-izimodal-close=""></i></dd>
            </dl>
            <div class="mqs-date"><i class="uil uil-calendar-alt"></i> 2021.01.4 ~ 2021.12.31 (331)</div>
            <ul class="mqs-content">
                <li>
                    <h3>ART</h3>
                    <div>
                        <div style="width:30%"></div>
                        <p>1 / 100</p>
                    </div>
                </li>
                <li>
                    <h3>Science</h3>
                    <div>
                        <div style="width:10%"></div>
                        <p>1 / 100</p>
                    </div>
                </li>
                <li>
                    <h3>Crowdsolving</h3>
                    <div>
                        <div style="width:60%"></div>
                        <p>1 / 100</p>
                    </div>
                </li>
                <li>
                    <h3>Competition</h3>
                    <div>
                        <div style="width:50%"></div>
                        <p>1 / 100</p>
                    </div>
                </li>
                <li>
                    <h3>Economy</h3>
                    <div>
                        <div style="width:3%"></div>
                        <p>1 / 100</p>
                    </div>
                </li>
                <li>
                    <h3>Community</h3>
                    <div>
                        <div style="width:10%"></div>
                        <p>1 / 100</p>
                    </div>
                </li>
            </ul>
            <div class="mqs-info">
                <h2>Title : Create Season of COJAM Service!</h2>
                <h2>Description : Create Season of COJAM Service!</h2>
                <div>
                    COJAM Fee : <span>8%</span><br />
                    Charity Fee : <span>2%</span><br />
                    Creator Fee : <span>5%</span><br />
                    Creator Pay : <span>0CT</span><br />
                    Minimum Pay : <span>5,000CT</span><br />
                    Maximum Pay : <span>300,000CT</span>
                </div>
            </div>
        </div>
    </div>
    <!-- 모달 - 퀘스트 시즌 끝 -->
    <script>
        $(document).ready(function(){
            $('#modalQuestSeason').iziModal({width : '500px'});
        });
    </script>
</th:block>

<th:block  th:fragment="modalSendCt">
    <!-- 모달 - SEND CT -->
    <div class="modal-send-ct" id="modalSendCT" style="display:none;">
        <form name="sendCtForm" method="post" action="">
            <fieldset>
                <legend>SEND CT</legend>
                <div class="msc-area">
                    <dl>
                        <dt>SEND CT</dt>
                        <dd><i id="modelSendCtClose" class="uil uil-times modal-close" data-izimodal-close=""></i></dd>
                    </dl>
                    <ul>
                        <li><input name="to" type="text" class="w100p" placeholder="Enter the recipient address" /></li>
                        <li><input name="amount" type="number" class="w100p" placeholder="Please enter CT amount" /></li>
                    </ul>
                    <p>
                        <a href="javascript:fnSendCT();">Send CT</a>
                    </p>
                </div>
            </fieldset>
        </form>
    </div>
    <!-- 모달 - SEND CT 끝 -->
    <th:block layout:fragment="script">
        <script>
            $(document).ready(function(){
                $('#modalSendCT').iziModal({width : '500px'});
            });

            function fnSendCT(){

                if($("input[name=to]").val()==""){
                    toastr.warning('Please enter address');
                    return;
                }

                if($("input[name=amount]").val()==""){
                    toastr.warning('Please enter amount');
                    return;
                }
                if(confirm("Do you really want to send?")){
                    $.ajax({
                        url: "/user/wallet/transfer",
                        type: "POST",
                        data : $("form[name=sendCtForm]").serialize(),
                        success : function(response){
                            if(response.check){
                                toastr.success('success');
                                $('#modelSendCtClose').click();
                            } else {
                                toastr.error(response.message);

                            }
                        }
                    });
                }
            }
        </script>
    </th:block>
</th:block>
<th:block  th:fragment="modalVotingDetail" >
    <!-- 모달 - 마이페이지 - Voting 상세 -->
    <div class="modal-mypage-view" id="modalMypageVoting" style="display:none;">
        <form name="addForm" method="post" action="">
            <fieldset>
                <legend>Voting Detail</legend>
                <div class="mmv-area">
                    <dl>
                        <dt>Voting Detail</dt>
                        <dd><i class="uil uil-times modal-close" data-izimodal-close=""></i></dd>
                    </dl>
                    <ul>
                        <li>
                            <span>Title</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Category</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Status</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Approve Transaction</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Adjourn Transaction</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Success Transaction</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Answer List</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>My Answer</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Selected Answer</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Spender Address</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Betting Transaction</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                    </ul>
                    <p>
                        <a href="#">Confirm</a>
                    </p>
                </div>
            </fieldset>
        </form>
    </div>
    <!-- 모달 - 마이페이지 - Voting 상세 끝 -->
    <th:block layout:fragment="script">
        <script>
            $(document).ready(function(){
                $('#modalMypageVoting').iziModal({width : '500px'});
            });
        </script>
    </th:block>
</th:block>
<th:block  th:fragment="modalGroundDetail">
    <!-- 모달 - 마이페이지 - Ground 상세 -->
    <div class="modal-mypage-view" id="modalMypageGround" style="display:none;">
        <form name="addForm" method="post" action="">
            <fieldset>
                <legend>Ground Detail</legend>
                <div class="mmv-area">
                    <dl>
                        <dt>Ground Detail</dt>
                        <dd><i class="uil uil-times modal-close" data-izimodal-close=""></i></dd>
                    </dl>
                    <ul>
                        <li>
                            <span>Title</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Category</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Status</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Description</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Approve Transaction</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Adjourn Transaction</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Success Transaction</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Answer List</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Selected Answer</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                        <li>
                            <span>Season</span>
                            <input name="name" type="text" class="w100p" placeholder="" />
                        </li>
                    </ul>
                    <p>
                        <a href="#">Confirm</a>
                    </p>
                </div>
            </fieldset>
        </form>
    </div>
    <!-- 모달 - 마이페이지 - Ground 상세 끝 -->
    <th:block layout:fragment="script">
        <script>
            $(document).ready(function(){
                // 모달 - 마이페이지 - Ground //
                $('#modalMypageGround').iziModal({width : '500px'});
            });
        </script>
    </th:block>
</th:block>
<th:block  th:fragment="modalTransferDetail">
    <!-- 모달 - 마이페이지 - Transfer 상세 -->
    <div class="modal-mypage-view" id="modalMypageTransfer" style="display:none;">
        <form name="addForm" method="post" action="">
            <fieldset>
                <legend>CT Transfer</legend>
                <div class="mmv-area">
                    <dl>
                        <dt>CT Transfer Detail</dt>
                        <dd><i class="uil uil-times modal-close" data-izimodal-close=""></i></dd>
                    </dl>
                    <ul>
                        <li>
                            <span>Spender Address</span>
                            <input id="spenderAddressStr" type="text" class="w100p" placeholder="" readonly/>
                        </li>
                        <li>
                            <span>Recipient Address</span>
                            <input id="recipientAddressStr" type="text" class="w100p" placeholder="" readonly/>
                        </li>
                        <li>
                            <span>CT Amount</span>
                            <input id="ctAmountStr" type="text" class="w100p" placeholder="" readonly/>
                        </li>
                        <li>
                            <span>Transaction</span>
                            <input id="transactionIdStr" type="text" class="w100p" placeholder="" readonly/>
                        </li>
                        <li>
                            <span>Status</span>
                            <input id="transferStatusStr" type="text" class="w100p" placeholder="" readonly/>
                        </li>
                        <li>
                            <span>DTTM</span>
                            <input id="createDateTimeStr" type="text" class="w100p" placeholder="" readonly/>
                        </li>
                    </ul>
                    <p>
                        <a href="javascript:$('#modalMypageTransfer').iziModal('close');" >Confirm</a>
                    </p>
                </div>
            </fieldset>
        </form>
    </div>
    <!-- 모달 - 마이페이지 - Transfer 상세 끝 -->
    <th:block layout:fragment="script">
        <script>
            let transactionKey = '';
            let spenderAddress = '';
            let recipientAddress = '';
            let transactionId = '';
            let ctAmount = '';
            let createDateTimeStr = '';
            $(document).ready(function(){
                $("#modalMypageTransfer").iziModal({
                    width : '500px',
                    transitionin : 'comingIn',
                    onOpening: function(modal){
                        modal.startLoading();
                        $.get('/user/mypage/transaction/'+transactionKey, function(data) {
                            console.debug(data);
                            if(data.check){
                                const item = data.item;
                                $('#spenderAddressStr').val(spenderAddress.trim());
                                $('#recipientAddressStr').val(recipientAddress.trim());
                                $('#ctAmountStr').val(ctAmount);
                                $('#transactionIdStr').val(transactionId);
                                $('#transferStatusStr').val(item);
                                $('#createDateTimeStr').val(createDateTimeStr);
                                modal.stopLoading();
                            }else{
                                toastr.error(response.message);
                                $('#modalMypageTransfer').iziModal('close');
                            }

                        });
                    }
                });
            });
        </script>
    </th:block>
</th:block>
</html>